# How to summarize featurization data

## What does it do?

The **Summarize_Featurization_Data.ipynb** Jupyter Notebook reads in all featurization data from the folder structure generated by Featurize.py, truncates it to only contain the data relevant for chemical space generation, and outputs it as a .csv file. Exemplary .csv file are given. To read in the data it goes through the "orca" folders of each substrate and uses a customparser to extract the information of interest. Some of these parameters are then used to calculate additional ones, e.g. HOMO/LUMO energies to calculate electron negativity.

## Step-by-step

### 1) Setup

For the script to properly function, RDkit has to be installed, a few constants need to be defined, and a few files need to be present within the same folder.

Make sure [RDkit](https://www.rdkit.org/) is installed, otherwise install it. This can be done in various ways, depending on your setup and preference. An easy way to install it is via [conda](https://anaconda.org/conda-forge/rdkit).

At the top of the script in the "CONSTANTS" section:

- define the path to the directory holding the "results" folder of the featurization you want to summarize (NOT THE RESULTS FOLDER ITSELF!).
- define the main atom of the functional group you used during the featurization. In its current state, this has to be "B" or "Br" as only these are implemented.
- define the "file_prefix", which is the same prefix chosen during featurization.
- define the "output_name", which is the name of the summarized .csv file.

Finally, create a folder and in it place the **Summarize_Featurization_Data.ipynb** Jupyter Notebook and the dataset.txt file (the one with all the SMILES). Also make sure the results.csv file generated by the second part of the featurization was added to the "results" folder with all the featurization data (Per default its generated in the parent folder of "results").

### 2) Run the script

If you did not compute any additional parameters to the ones that are listed in the main README.md you are ready to run the script. Otherwise you can adjust the parser to also include your additional data. For this refer to the respective **Optional** section below.

To summarize the featurization data:

1) Run the first block of code to import essential modules and define a function to retrieve text from a file.

2) Run the second block to read in your defined constants.

3) Run the third block to change the directory and then initialize the collected_data dictionary. The dictionary is the populated with various parameters by the parser and similar protocols.

4) Run the fourth block to truncate the featurization data to only data that is relevant for the chemical space generation. This data is saved in the plot_data dictionary. As data that is relevant for the chemical space generation we only consider global properties (dipole, HOMO/LUMO energies, etc.) or properties of the carbon attached to the main functional group (with the current setup Br or boronic acids). Incomplete entries are removed completely at this step.

5) Run the fifth block to compile the plot_data dictionary as a .csv file.

### (Optional) Adjust the parser

To adjust the parser you need to add an additional entry to the "params_of_interest" array. The structure of such an entry is as follows:

{
    "keyword": "CHEMICAL SHIELDING SUMMARY",
    "abbr": "CHEM SHIELD",
    "y_offset": 6,
    "keep_index": [0, 1, 2]
}

The keyword has to be a unique string with the ORCA output file and is used to locate the block of results within this file. In our case the parser will open an ORCA output file and search it for "CHEMICAL SHIELDING SUMMARY", which it finds in the following block:

>–-------------------------------      
>**CHEMICAL SHIELDING SUMMARY** (ppm)      
>–-------------------------------     
>
>
>  Nucleus  Element    Isotropic     Anisotropy
>  -------  -------  ------------   ------------
>      3       C           54.135        213.866 
>      4       C           46.479        205.318 
>      5       C           55.608        189.640 
>      6       C           51.978        195.684 
>      7       C           57.026        187.257 
>      8       C           51.793        191.717 
>      1       B           78.357         21.464